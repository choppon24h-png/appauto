(function(){'use strict';window.openCompleteModal=function(){document.getElementById('complete-modal').classList.add('active')};window.closeCompleteModal=function(){document.getElementById('complete-modal').classList.remove('active')};window.openPickupModal=function(){document.getElementById('pickup-modal').classList.add('active')};window.closePickupModal=function(){document.getElementById('pickup-modal').classList.remove('active')};const completeForm=document.getElementById('complete-form');if(completeForm){completeForm.addEventListener('submit',async function(e){e.preventDefault();const formData=new FormData(this);const btn=this.querySelector('button[type="submit"]');btn.disabled=true;btn.textContent='Finalizando...';try{const response=await fetch(`/fornecedor/os/${OS_ID}/finalizar`,{method:'POST',headers:{'X-Requested-With':'XMLHttpRequest'},body:formData});const result=await response.json();if(result.sucesso){showMessage('success',result.mensagem);closeCompleteModal();setTimeout(()=>window.location.reload(),1500)}else{showMessage('error',result.mensagem)}}catch(error){showMessage('error','Erro ao finalizar O.S')}finally{btn.disabled=false;btn.textContent='Finalizar e Gerar Certificado'}})}const pickupForm=document.getElementById('pickup-form');if(pickupForm){pickupForm.addEventListener('submit',async function(e){e.preventDefault();const formData=new FormData(this);const btn=this.querySelector('button[type="submit"]');btn.disabled=true;btn.textContent='Registrando...';try{const response=await fetch(`/fornecedor/os/${OS_ID}/retirada`,{method:'POST',headers:{'X-Requested-With':'XMLHttpRequest'},body:formData});const result=await response.json();if(result.sucesso){showMessage('success',result.mensagem);closePickupModal();setTimeout(()=>window.location.reload(),1500)}else{showMessage('error',result.mensagem)}}catch(error){showMessage('error','Erro ao registrar retirada')}finally{btn.disabled=false;btn.textContent='Confirmar Retirada'}})}function showMessage(type,text){const container=document.getElementById('message-container');if(!container)return;const message=document.createElement('div');message.className=`message message-${type}`;message.innerHTML=`<span class="message-icon">${type==='success'?'✓':'✗'}</span><span class="message-text">${text}</span><button class="message-close" onclick="this.parentElement.remove()">×</button>`;container.appendChild(message);setTimeout(()=>message.remove(),5000);window.scrollTo({top:0,behavior:'smooth'})}window.showMessage=showMessage})();
