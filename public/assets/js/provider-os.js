(function(){'use strict';const clienteSelect=document.getElementById('cliente-select');const veiculoSelect=document.getElementById('veiculo-select');const valorMaoObra=document.getElementById('valor-mao-obra');const valorPecas=document.getElementById('valor-pecas');const valorTotal=document.getElementById('valor-total');if(clienteSelect){clienteSelect.addEventListener('change',async function(){const clienteId=this.value;veiculoSelect.innerHTML='<option value="">Carregando...</option>';veiculoSelect.disabled=true;if(!clienteId){veiculoSelect.innerHTML='<option value="">Selecione o cliente primeiro</option>';return}try{const response=await fetch(`/fornecedor/clientes/${clienteId}/veiculos`);const result=await response.json();if(result.sucesso&&result.veiculos.length>0){veiculoSelect.innerHTML='<option value="">Selecione o veículo</option>';result.veiculos.forEach(v=>{const option=document.createElement('option');option.value=v.id;option.textContent=`${v.marca} ${v.modelo} - ${v.placa}`;veiculoSelect.appendChild(option)});veiculoSelect.disabled=false}else{veiculoSelect.innerHTML='<option value="">Nenhum veículo encontrado</option>'}}catch(error){veiculoSelect.innerHTML='<option value="">Erro ao carregar veículos</option>'}})}function updateTotal(){const maoObra=parseFloat(valorMaoObra.value)||0;const pecas=parseFloat(valorPecas.value)||0;const total=maoObra+pecas;valorTotal.value=`R$ ${total.toFixed(2).replace('.',',')}`}if(valorMaoObra)valorMaoObra.addEventListener('input',updateTotal);if(valorPecas)valorPecas.addEventListener('input',updateTotal);const form=document.getElementById('os-form');if(form){form.addEventListener('submit',async function(e){e.preventDefault();const formData=new FormData(this);const btn=this.querySelector('button[type="submit"]');btn.disabled=true;btn.textContent='Criando...';try{const response=await fetch('/fornecedor/os',{method:'POST',headers:{'X-Requested-With':'XMLHttpRequest'},body:formData});const result=await response.json();if(result.sucesso){showMessage('success',result.mensagem);setTimeout(()=>window.location.href='/fornecedor/os',1500)}else{showMessage('error',result.mensagem)}}catch(error){showMessage('error','Erro ao criar O.S')}finally{btn.disabled=false;btn.textContent='Criar O.S'}})}function showMessage(type,text){const container=document.getElementById('message-container');if(!container)return;const message=document.createElement('div');message.className=`message message-${type}`;message.innerHTML=`<span class="message-icon">${type==='success'?'✓':'✗'}</span><span class="message-text">${text}</span><button class="message-close" onclick="this.parentElement.remove()">×</button>`;container.appendChild(message);setTimeout(()=>message.remove(),5000);window.scrollTo({top:0,behavior:'smooth'})}window.showMessage=showMessage})();
